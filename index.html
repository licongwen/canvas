<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
	*{margin: 0;padding: 0;}
	body{background: black;}
	#div1{background: white;width: 600px;margin: 20px auto;}
	</style>
	<script type="text/javascript">
	window.onload=function()
	{
		var oC=document.getElementById('c1');
		var oGc=oC.getContext('2d');
		var i=0;

		var yImg = new Image();
		yImg.src='index.png';

		yImg.onload=function()
		{
			setInterval(function()
			{
				oGc.clearRect(0,0,oC.width,oC.height);

				oGc.beginPath();
				oGc.arc(300,200,200,-90*Math.PI/180,180*Math.PI/180,false);
				oGc.stroke();

				oGc.beginPath();
				oGc.arc(250,200,150,-180*Math.PI/180,0*Math.PI/180,false);
				oGc.stroke();

				oGc.beginPath();
				oGc.arc(400,200,20,0,360*Math.PI,false);
				oGc.stroke();

				for(var i=0;i<ball.length;i++)
				{
					oGc.beginPath();
					oGc.moveTo(ball[i].x, ball[i].y);
					oGc.arc(ball[i].x,ball[i].y,20,0,360*Math.PI/180,false);
					oGc.fill();
				}
				//文字简易祖玛
				oGc.save();
				oGc.font='60px impact';
				oGc.textBaseline='top';
				oGc.fillStyle='red';
				oGc.shadowOffsetX='10';
				oGc.shadowOffsetY='10';
				oGc.shadowColor='green';
				oGc.shadowBlur='5';
				var w=oGc.measureText('简易祖玛').width;
				var h=60;
				oGc.fillText('简易祖玛',(oC.width-w)/2,450);
				oGc.restore();
				//中间图案
				oGc.save();
				oGc.translate(300,200);
				oGc.rotate(iRotate);
				oGc.translate(-40,-40);
				oGc.drawImage(yImg,0,0);
				oGc.restore();

				//生成红色的小球
				for(var i=0;i<bullute.length;i++)
				{
					oGc.save();
					oGc.beginPath();
					oGc.fillStyle='red';
					oGc.moveTo(bullute[i].x,bullute[i].y);
					oGc.arc(bullute[i].x,bullute[i].y,20,0,360*Math.PI/180,false);
					oGc.fill();
					oGc.restore();
				};
			}, 1000/60);

			setInterval(function()
			{
				for(var i=0;i<ball.length;i++)
				{
					ball[i].num++;
					if(ball[i].num==270)
					{
						ball[i].r=150;
						ball[i].startX=250;
						ball[i].startY=50;
					}
					if(ball[i].num==270+180)
					{
						alert('游戏结束');
					}

					ball[i].x=ball[i].startX+ball[i].r*Math.sin(ball[i].num*Math.PI/180);
					ball[i].y=ball[i].r-ball[i].r*Math.cos(ball[i].num*Math.PI/180)+ball[i].startY;
				}
				for(var i=0;i<bullute.length;i++)
				{
					bullute[i].x=bullute[i].x+bullute[i].sX;
					bullute[i].y=bullute[i].y+bullute[i].sY;
				}

				for(var i=0;i<bullute.length;i++)
				{
					for(var j=0;j<ball.length;j++)
					{
						if(qz(bullute[i].x,bullute[i].y,ball[j].x,ball[j].y))
						{
							bullute.splice(i,1);
							ball.splice(j,1);
							
							break;
						}
					}
				}
			}, 30);
			//绘制小球
			var ball=[];
			setInterval(function()
			{
				ball.push({
					x:300,
					y:0,
					r:200,
					startX:300,
					startY:0,
					num:0
				});
			}, 500);

			//使中间图案跟着鼠标移动
			var iRotate=0;
			oC.onmousemove=function(ev)
			{
				var ev=ev||window.event;
				var a=ev.clientX-oC.offsetLeft-300;
				var b=ev.offsetY-oC.offsetTop-200;
				var c=Math.sqrt(a*a+b*b);
				if(a>0 && b>0)
				{
					iRotate=Math.asin(b/c)+90*Math.PI/180;
				}
				else if(a>0 && b<0)
				{
					iRotate=Math.asin(a/c);
				}
				else if(a<0 && b<0)
				{
					iRotate=Math.asin(a/c);
				}
				else if(a<0 && b>0)
				{
					iRotate=-(Math.asin(b/c)+90*Math.PI/180);
				}
			}
			
			//绘制子弹
			var bullute=[];
			
			oC.onmousedown=function(ev)
			{
				var ev=ev||woindow.event;
				var x=ev.clientX-oC.offsetLeft;
				var y=ev.clientY-oC.offsetTop;

				var a=x-300;
				var b=y-200;

				var c=Math.sqrt(a*a+b*b);
				var speed=5;

				var sX=speed*a/c;
				var sY=speed*b/c;

				bullute.push({
					x:300,
					y:200,
					sX:sX,
					sY:sY,
				});
			}
			//确定是否碰撞的函数	
			function qz(x1,y1,x2,y2)
			{
				var a=x1-x2;
				var b=y1-y2;

				var c=Math.sqrt(a*a+b*b);


				if(c<40)
				{
					return true;
				}
				else
				{
					return false;
				}
			}

		}		
	}
	</script>
</head>
<body>
<div id="div1">
	<canvas id="c1" width="600" height="600">
		
	</canvas>
</div>
	
</body>
</html>